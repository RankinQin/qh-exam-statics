var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;import{O as o,o as l,c as i,w as n,d,e as c,t as u,f as p,r as h,S as f,F as y,i as m,j as b,l as _,k as w,g as x,A as v,s as k,x as P,h as g,T as C,C as I}from"./index.d7537bc6.js";import{m as O,p as T,a as R,_ as j}from"./uni-popup.67d8a74b.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import{r as S}from"./uni-app.es.f6cd1c1c.js";import{d as U,o as $}from"./api.66e70d95.js";const{t:H}=o(O);var E=W({name:"UniPopupShare",mixins:[T],emits:["select"],props:{title:{type:String,default:""},beforeClose:{type:Boolean,default:!1}},data:()=>({bottomData:[{text:"微信",icon:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-dc-site/c2b17470-50be-11eb-b680-7980c8a877b8.png",name:"wx"},{text:"支付宝",icon:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-dc-site/d684ae40-50be-11eb-8ff1-d5dcf8779628.png",name:"wx"}]}),created(){},computed:{cancelText:()=>H("uni-popup.cancel"),shareTitleText(){return this.title||H("uni-popup.shareTitle")}},methods:{select(e,t){this.$emit("select",{item:e,index:t}),this.close()},close(){this.beforeClose||this.popup.close()}}},[["render",function(e,t,s,a,r,o){const x=m,v=b,k=_,P=w;return l(),i(v,{class:"uni-popup-share"},{default:n((()=>[d(v,{class:"uni-share-title"},{default:n((()=>[d(x,{class:"uni-share-title-text"},{default:n((()=>[c(u(o.shareTitleText),1)])),_:1})])),_:1}),d(v,{class:"uni-share-content"},{default:n((()=>[d(v,{class:"uni-share-content-box"},{default:n((()=>[(l(!0),p(y,null,h(r.bottomData,((e,t)=>(l(),i(v,{class:"uni-share-content-item",key:t,onClick:f((s=>o.select(e,t)),["stop"])},{default:n((()=>[d(k,{class:"uni-share-image",src:e.icon,mode:"aspectFill"},null,8,["src"]),d(x,{class:"uni-share-text"},{default:n((()=>[c(u(e.text),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),d(v,{class:"uni-share-button-box"},{default:n((()=>[d(P,{class:"uni-share-button",onClick:o.close},{default:n((()=>[c(u(o.cancelText),1)])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-5d4bc0ab"]]);var D=W({data:()=>({ios:!1,showWaitPayResult:!1,result:{brief:"",detail:"",key:[]},scores:[],order:{},testpaper:{},uQRCode:"",interval:null}),onPullDownRefresh(){this.reloadOrderWhenPaid()},onLoad(e){console.log(e),e.method,e.method&&["wx","alipay.trade.wap.pay.return"].indexOf(e.method)>-1&&(this.showWaitPayResult=!0);let t=e.paperId;this.isIos(),this.init(t)},created(){},onUnload(){this.interval&&(clearInterval(this.interval),this.interval=null)},methods:{isIos(){},init(e){let t=x("tmp_order");console.log(t),t?501===t.order.status?this.$nextTick((()=>{console.log(t.order.status),this.order=t.order,this.testpaper=t.testpaper,this.answers=t.answers,this.result=t.result})):(this.order=t.order,this.testpaper=t.testpaper,this.answers=t.answers,this.$nextTick((()=>{this.showWaitPayResult&&this.$refs.waitPayResultPopup.open()}))):v(e?{url:"/pages/exam/question/question?id="+e}:{url:"/pages/index/index"})},async reloadOrderWhenPaid(){let e=await U(this.order.orderId);if(console.log(e),10===e.status||501===e.status){let o=JSON.parse(e.result);this.$nextTick((()=>{this.order=e,this.result=o.result,this.scores=o.scores})),k("tmp_order",((e,o)=>{for(var l in o||(o={}))s.call(o,l)&&r(e,l,o[l]);if(t)for(var l of t(o))a.call(o,l)&&r(e,l,o[l]);return e})({order:e,testpaper:this.testpaper},o)),this.interval&&(clearInterval(this.interval),this.interval=null)}else this.$nextTick((()=>{this.$refs.waitPayResultPopup.open()}))},async wxH5Pay(){let e=await $(this.order.payOrderId,"wx_h5");console.log(e.invokeResponse+"&redirect_url="+encodeURIComponent(window.location.href+"&method=wx")),window.location.href=e.invokeResponse+"&redirect_url="+encodeURIComponent(window.location.href+"&method=wx")},async aliH5Pay(){let e=await $(this.order.payOrderId,"alipay_wap");document.getElementById("alipay-form").innerHTML=e.invokeResponse.body,document.forms[0].submit()},selectPayWay(e){0===e.index?this.wxH5Pay():this.aliH5Pay()},async buy(){this.interval&&clearInterval(this.interval),console.log(this.storeContext),this.$refs.payWayPopup.open()}}},[["render",function(e,t,s,a,r,o){const p=b,h=m,f=C,y=w,_=S(I("uni-popup-share"),E),x=S(I("uni-popup"),R),v=S(I("uni-popup-dialog"),j);return l(),i(p,{class:"rc"},{default:n((()=>[d(p,{class:P(["result-content",{fil:501!==r.order.status}])},{default:n((()=>[d(p,{class:"title"},{default:n((()=>[d(p,{class:"h"},{default:n((()=>[c(u(r.testpaper.name),1)])),_:1}),d(p,{class:"desc"},{default:n((()=>[c("测评报告")])),_:1})])),_:1}),d(p,{class:"rc-body-ct"},{default:n((()=>[d(p,null,{default:n((()=>[c("测评结果:"),d(h,{class:"res"},{default:n((()=>[c(u(r.result.key.join("")),1)])),_:1})])),_:1}),d(p,null,{default:n((()=>[c(u(r.result.brief),1)])),_:1})])),_:1}),d(p,{class:".rc-body-ct rc-detail"},{default:n((()=>[d(p,null,{default:n((()=>[c("详细解析:")])),_:1}),d(f,{nodes:r.result.detail},null,8,["nodes"])])),_:1})])),_:1},8,["class"]),501!==r.order.status?(l(),i(p,{key:0,class:"buy-ct"},{default:n((()=>[r.ios&&r.order.amount>0?(l(),i(y,{key:0,disabled:!0,style:{"background-color":"#2979ff","border-radius":"0",color:"white"},onClick:t[0]||(t[0]=e=>o.buy()),type:"warn"},{default:n((()=>[c("由于相关规范，iOS功能暂不可用")])),_:1})):(l(),i(y,{key:1,style:{"background-color":"#2979ff","border-radius":"0",color:"white"},onClick:t[1]||(t[1]=e=>o.buy()),type:"warn"},{default:n((()=>[c("开启测评结果"),r.order.amount>0?(l(),i(h,{key:0},{default:n((()=>[c("（￥"+u(r.order.amount/100)+"）",1)])),_:1})):g("",!0)])),_:1}))])),_:1})):g("",!0),d(p,{id:"alipay-form"}),d(x,{ref:"payWayPopup",type:"share"},{default:n((()=>[d(_,{title:"选择支付方式",onSelect:o.selectPayWay},null,8,["onSelect"])])),_:1},512),d(x,{ref:"waitPayResultPopup",type:"dialog"},{default:n((()=>[d(v,{content:"已完成支付？",duration:2e3,confirmText:"已完成支付",cancelText:"取消支付",onConfirm:o.reloadOrderWhenPaid},null,8,["onConfirm"])])),_:1},512)])),_:1})}],["__scopeId","data-v-542c8d65"]]);export{D as default};
